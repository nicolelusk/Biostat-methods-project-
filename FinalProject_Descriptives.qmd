---
title: "Descriptive Statistics"
format: html
---


### Research Question and Variables to be Included

How does fasting influence insulin and cholesterol levels in adult men and women? 

In our final project we will look at gender, age, and length of food fast (hours) to understand how different fasting aspect will affect two continuous outcome variables, insulin and cholesterol. 

We will also take into account individuals that have diabetes, as their insulin regulation is compromised. 

### Trends Observed Thusfar

In our visualization we can see that the data has a similar number of men and women, with the most common ages being 0-20 and 60-80. The ages appear to be consistent across gender. 

Initially, we wanted to observe fasting across food as well as tea and coffee and alcohol. However, there were not many people who reported fasting from either coffee and tea or alcohol, so this data may not be helpful is our assessment since most of the values for these are missing. The average food fast was 8.59 hours. Food fasting alone has a low correlation with both our insulin and cholesterol levels. 

Cholesterol levels appear to be slightly higher in females and insulin levels appear to be slightly lower in females when compared to males. Age does not appear to be strongly correlated with cholesterol. However, we noted that the trends in people with diabetes differ from those without diabetes. Similarly, there was not a strong observation between just age and insulin levels. 

Furthermore we found there there was not a correlation between insulin and cholesterol levels. 

```{r}
library("here")
library("haven")
library("tidyverse")
Demographics<-read_xpt(here("DEMO_L.xpt"))
Fasting<-read_xpt(here("FASTQX_L.xpt"))
Insulin<-read_xpt(here("INS_L.xpt"))
Cholesterol<-read_xpt(here("TCHOL_L.xpt"))
Diabetes<-read_xpt(here("DIQ_L.xpt"))


FullData_df<-Demographics|>
  full_join(Fasting, by = "SEQN")|>
  full_join(Insulin, by = "SEQN")|>
  full_join(Cholesterol, by = "SEQN")|>
  full_join(Diabetes, by = "SEQN")

Data_df<-FullData_df|> 
  select("SEQN", "RIAGENDR", "RIDAGEYR", "PHQ020", "PHACOFHR", "PHQ030", "PHAALCHR", "PHAFSTHR", "LBXTC", "LBXIN", "DIQ010", "DIQ050", "DIQ160")|>
  rename("Sequence" = SEQN,
         "Sex" = RIAGENDR,
         "Age" = RIDAGEYR,
        "Coffee_or_Tea_Factor" = PHQ020, "Hrs_CoffeeTea" = PHACOFHR, 
        "Alcohol_Factor" = PHQ030, "Hrs_Alcohol" = PHAALCHR,
        "Hrs_Food" = PHAFSTHR, 
        "Cholesterol" = LBXTC,
        "Insulin" = LBXIN,
        "Diabetes" = DIQ010, "Taking_Insulin" = DIQ050, "Prediabetes" = DIQ160)|>
  mutate(Sex = case_when(Sex == 1 ~"male", 
                         Sex == 2 ~ "female"),
         Coffee_or_Tea_Factor = case_when(Coffee_or_Tea_Factor == 1 ~ "yes",
                                          Coffee_or_Tea_Factor == 2 ~"no",
                                          .default = NA),
         Alcohol_Factor = case_when(Alcohol_Factor == 1 ~ "yes",
                                 Alcohol_Factor == 2 ~ "no", 
                                 .default = NA),
         Diabetes = ifelse(Diabetes == 1, "yes", "other"),
         Prediabetes = ifelse(Prediabetes == 1, "yes", "other"),
         Taking_Insulin = ifelse(Taking_Insulin == 1, "yes", "other"))

```

Cholesterol = mg/dL
Insulin = uU/mL

Coffee_or_Tea_Factor = Whether or not an individual fasted from coffee/tea
Same as alcohol 


### Single Variable Visualizations

#### Sex 

```{r}
Data_df|>group_by(Sex)|>
  summarise(n = n())

ggplot(data = Data_df, aes(x = Sex))+
  geom_bar()+
  theme_minimal()
```

Here we can see that we have similar amounts of males and females in our dataset, but there about 800 more females than males. 

#### Age

```{r}
Data_df|>summarise(mean = mean(Age),
                   sd = sd(Age))

ggplot(data = Data_df, aes(x = Age))+
  geom_histogram()+
  theme_minimal()
```

From our exploration we can see that the distribution of sex in our dataset is a little bimodal, with more individuals between 0-20 and 60-80. In our numerical summary we can see that the mean is 38.3 years old. 

#### Coffee Fast & How Long

```{r}
Data_df|>group_by(Coffee_or_Tea_Factor)|>
  filter(Coffee_or_Tea_Factor == "no"|
           Coffee_or_Tea_Factor == "yes")|>
  summarise(n = n())

coffee_fast<-Data_df|> filter(Coffee_or_Tea_Factor == "yes")

ggplot(data = coffee_fast, aes(y = Hrs_CoffeeTea))+
  geom_boxplot()+
  theme_minimal()

coffee_fast|> summarise(mean = mean(Hrs_CoffeeTea),
                        sd = sd(Hrs_CoffeeTea))
```

Here we can see that only 29 people fasted from coffee/tea. Those that did fast are displayed in the above boxplot, which shows us that the majority of fasting time lies between ~4-11 hours. From a specific numerical summary we can see that the mean fasting time from coffee and tea was 7.55, and there was some spread with the standard deviation falling at 5.88.


#### Length of Food Fast 

```{r}
Data_df|> summarise(mean = mean(Hrs_Food, na.rm = TRUE),
                    median = median(Hrs_Food, na.rm = TRUE),
                    sd= sd(Hrs_Food, na.rm = TRUE))

ggplot(data = Data_df, aes(x = Hrs_Food))+
  geom_histogram()+
  theme_minimal()
```

In our exploration of food fast we can see that the average fast last 8.59 hours and that the standard deviation is 5.64. In our visual, we can see that the distribution of food fast is bi-modal, with popular fast lengths ~4 and ~15 hours. After the second peak, the distribution falls drastically with much smaller numbers of individuals fasting for over 20 hours. 

#### Diabetes & Insulin Usage 

```{r}
Data_df|>group_by(Diabetes)|>
  summarise(n = n())

ggplot(data = Data_df, aes(x = Diabetes))+
  geom_bar()+
  theme_minimal() 

Data_df|>filter(Diabetes == "yes")|>
  group_by(Taking_Insulin)|>
  summarise(n = n())

Diabetes_only<-Data_df|>filter(Diabetes == "yes")

ggplot(data = Diabetes_only, aes(x = Taking_Insulin))+
  geom_bar()+
  theme_minimal()

```

Looking at our data we can see that although a majority do not have diabetes, we do have a subgroup of 1081 individuals who answered "yes" in the survey asking if they have ever been diagnosed with diabetes. We also want to show that out of those 1081 individuals 344 are actively taking insulin. This will be something to be aware of as we continue to analyze the data, and we may want to exclude these individuals. 

#### Cholesterol 

```{r}
Data_df|> summarise( mean = mean(Cholesterol, na.rm = TRUE),
                     sd = sd(Cholesterol, na.rm = TRUE))

ggplot(data = Data_df, aes(x = Cholesterol))+
  geom_histogram()+
  theme_minimal()
```


We can see that cholesterol presents as a unimodal distribution, with a mean around 182mg/dL and sd of 42.3mg/dL. From our histogram, we can see the peak seems to be localized between the 150mg/dL and 250mg/dL range. 

#### Insulin 

```{r}
Data_df|> summarise( mean = mean(Insulin, na.rm = TRUE),
                     sd = sd(Insulin, na.rm = TRUE))

ggplot(data = Data_df, aes(x = Insulin))+
  geom_boxplot()+
  theme_minimal()

Data_InsulinLT200<-Data_df|> filter(Insulin < 100)

Data_InsulinLT200|> summarise( mean = mean(Insulin, na.rm = TRUE),
                     sd = sd(Insulin, na.rm = TRUE))

ggplot(data = Data_InsulinLT200, aes(x = Insulin))+
  geom_boxplot()+
  theme_minimal()

ggplot(data = Data_InsulinLT200, aes(x = Insulin))+
  geom_histogram()+
  theme_minimal()

```

Finally, looking at our last outcome variable insulin, we can see in our visualizations that there are some pretty extreme outliers. Overall, we obtain a mean insulin level of 14.7uU/mL and a standard deviation of 26.1uU/mL. If we are to restrict our range of insulin to <100uU/mL, we can a better understanding of the pattern for the majority of subjects. When we do so we can see that our mean decreases to 13uU/mL and standard deviation of 11.5uU/mL, showing that the outliers are skewing the summary statistics. We can also see in our new graphs that the majority fall around that single peak near 12.5, and then tapers off by 25uU/mL.


### Bivariate Visualization 

```{r}
cor(Data_df$Hrs_Food, Data_df$Cholesterol, use = "pairwise.complete.obs")


ggplot(data = Data_df, aes(x = Hrs_Food, y = Cholesterol, color = factor(Diabetes)))+
  geom_point(na.rm = TRUE)+
  geom_smooth(method = 'lm', se = FALSE, 
              aes(color = factor (Diabetes), group = factor(Diabetes)))+
  labs(color = "Diabetes Status")
  

#ggplot(data = Data_df, aes(x = Hrs_Alcohol, y = Cholesterol, color = factor(Diabetes)))+
#  geom_point(na.rm = TRUE)

#ggplot(data = Data_df, aes(x = Hrs_CoffeeTea, y = Cholesterol, color = factor(Diabetes)))+
#  geom_point(na.rm = TRUE)
```
This plot shows the hours fasted and its impact on cholesterol for the whole population. The correlation is .03205494. The scatter plot hows that those with diabetes are less impacted than those without by hours fasted. We can see that there are less values between 20 and 30 hours fasted from food. 


```{r}
cor(Data_df$Hrs_Food, Data_df$Insulin, use = "pairwise.complete.obs")

ggplot(data = Data_df, aes(x = Hrs_Food, y = Insulin, color = factor(Diabetes)))+
  geom_point(na.rm = TRUE)+
  geom_smooth(method = 'lm', se = FALSE, 
              aes(color = factor (Diabetes), group = factor(Diabetes)))+
  labs(color = "Diabetes Status")

ggplot(data = Data_df, aes(x = Hrs_Food, y = Insulin, color = factor(Taking_Insulin)))+
  geom_point(na.rm = TRUE)+
  geom_smooth(method = 'lm', se = FALSE, 
              aes(color = factor (Taking_Insulin), group = factor(Taking_Insulin)))+
  labs(color = "Taking Insulin Status")

#ggplot(data = Data_df, aes(x = Hrs_Alcohol, y = Insulin, color = factor(Diabetes)))+
#  geom_point(na.rm = TRUE)

#ggplot(data = Data_df, aes(x = Hrs_CoffeeTea, y = Insulin, color = factor(Diabetes)))+
#  geom_point(na.rm = TRUE)
```
The correlation of hours fasted from food and insulin levels is -.1212528. From the scatterplot we can see that with the exception of one person who had an insulin level over 600 uU/ml, all of the data points above 200 uU/ml have diabetes. Additionally, the line of people with diabetes appears to decrease, while line of people who do not appears fairly flat. 
Furthermore, in the graph colored for people taking insulin, we can see that while the people with diabetes are similar to those who are taking insulin, as is expected, they are not exactly the same. The line of people taking insulin appears to have a smaller average value of the slope than those with diabetes. 

```{r}
Data_df %>%
  drop_na(Sex, Cholesterol) %>%
  group_by(Sex) %>%
  summarise(n = n(),
            mean = mean(Cholesterol),
            median = median(Cholesterol),
            min = min(Cholesterol),
            max = max(Cholesterol),
            q25 = quantile(Cholesterol,.25), # 25th percentile (1st quartile)
            q75 = quantile(Cholesterol,.75), # 75ht percentile (3rd quartile)
            var = var(Cholesterol),
            sd = sd(Cholesterol)) %>%
  mutate(IQR = q75-q25, 
         range = max - min)


ggplot(data = Data_df, aes(x = Sex, y = Cholesterol))+
  geom_boxplot()
#boxplot of cholesterol for each sex 
```

The mean cholesterol level for women (186.1772 mg/dL) was about 10 mg/dL higher than the mean for men (176.1122 mg/dL). Both men ad women have similar standard deviation, about 42mg/dL. The box plots both have many outliers with high cholesterol, and the females have one low outlier with a cholesterol level of 63. The male and female box plots appear to have a similar shape, but the mens distribution is centered around a median of 173 mg/dL while the women's is centered around 182, and is therefore shifted higher. Since both medians are lower than the means, and there are so many high outliers, we can conclude that the data is skewed right. 

```{r}
Data_df %>%
  drop_na(Sex, Insulin) %>%
  group_by(Sex) %>%
  summarise(n = n(),
            mean = mean(Insulin),
            median = median(Insulin),
            min = min(Insulin),
            max = max(Insulin),
            q25 = quantile(Insulin,.25), # 25th percentile (1st quartile)
            q75 = quantile(Insulin,.75), # 75ht percentile (3rd quartile)
            var = var(Insulin),
            sd = sd(Insulin)) %>%
  mutate(IQR = q75-q25, 
         range = max - min)

ggplot(data = Data_df, aes(x = Sex, y = Insulin))+
  geom_bar(stat = "summary", fun = "mean")
#average insulin level for each sex
```
The female mean insulin level is 14.13882 uU/ml, this is about 1.3 less than the mean insulin level of the males of 15.42506. The males have a median of 10.040 uU/ml, since this is lower than the mean, we can conclude that this is skewed right. The same is true for the females who have a median of 9.345 uU/ml. Since the bar graph shows the mean values because the number of men and women in the sample are different, we can see that the means vary. 


```{r}
cor(Data_df$Age, Data_df$Cholesterol, use = "pairwise.complete.obs")


ggplot(data = Data_df, aes(x = Age, y = Cholesterol, color = factor(Diabetes)))+
  geom_point(na.rm = TRUE)+
  geom_smooth(method = 'lm', se = FALSE, 
              aes(color = factor (Diabetes), group = factor(Diabetes)))+
  labs(color = "Diabetes Status")

```

The correlation between age and cholesterol level is .2225634. Our dot plot shows that the values vary across ages, the trend increasing slightly. However, it is important to note that the trend line of people with diabetes following the opposite pattern, as age increases in people with diabetes, the cholesterol level decreases. 

```{r}
cor(Data_df$Age, Data_df$Insulin, use = "pairwise.complete.obs")

ggplot(data = Data_df, aes(x = Age, y = Insulin, color = factor(Diabetes)))+
  geom_point(na.rm = TRUE)+
  geom_smooth(method = 'lm', se = FALSE, 
              aes(color = factor (Diabetes), group = factor(Diabetes)))+
  labs(color = "Diabetes Status")

```

The correlation of Age and Insulin level is -0.01276559. The scatterplot shows most of the values consistent with age. The values that we noted had high insulin levels appear to mostly be in adults over 55. The outlier without diabetes with a high insulin level is a very young participant. Most of the non-diabetes subjects appear to have consistent insulin levels throughout the age groups. 

```{r}
Data_df %>%
  drop_na(Sex, Age) %>%
  group_by(Sex) %>%
  summarise(n = n(),
            mean = mean(Age),
            median = median(Age),
            min = min(Age),
            max = max(Age),
            q25 = quantile(Age,.25), # 25th percentile (1st quartile)
            q75 = quantile(Age,.75), # 75ht percentile (3rd quartile)
            var = var(Age),
            sd = sd(Age)) %>%
  mutate(IQR = q75-q25, 
         range = max - min)


ggplot(data = Data_df, aes(x = Sex, y = Age))+
  geom_boxplot()
```

The mean age of the females is 39.37 years old and the mean age of the males is 37.12 years old. Both populations have minimum values of 0 and maximum values of 80. Both also have standard deviations around 25. Looking at the box plots, we can see that the men and women samples look to be similar across the agr groups. 

```{r}
cor(Data_df$Cholesterol, Data_df$Insulin, use = "pairwise.complete.obs")

ggplot(data = Data_df, aes(x = Cholesterol, y = Insulin, color = factor(Diabetes)))+
  geom_point(na.rm = TRUE)+
  geom_smooth(method = 'lm', se = FALSE, 
              aes(color = factor (Diabetes), group = factor(Diabetes)))+
  labs(color = "Diabetes Status")
```
The correlation between the insulin and cholesterol levels is -0.08358265, As we can see from the graph, many of the outliers with very high insulin have lower cholesterol levels. 
