---
title: "Descriptive Statistics"
format: html
---


### Research Question and Variables to be Included

How does fasting influence insulin and cholesterol levels in adult men and women? 

In our final project we will look at gender, age, and length of food fast (hours) to understand how different fasting aspect will affect two continuous outcome variables, insulin and cholesterol. 

We will also take into account individuals that have diabetes, as their insulin regulation is compromised. 

```{r}
library("here")
library("haven")
library("tidyverse")
Demographics<-read_xpt(here("DEMO_L.xpt"))
Fasting<-read_xpt(here("FASTQX_L.xpt"))
Insulin<-read_xpt(here("INS_L.xpt"))
Cholesterol<-read_xpt(here("TCHOL_L.xpt"))
Diabetes<-read_xpt(here("DIQ_L.xpt"))


FullData_df<-Demographics|>
  full_join(Fasting, by = "SEQN")|>
  full_join(Insulin, by = "SEQN")|>
  full_join(Cholesterol, by = "SEQN")|>
  full_join(Diabetes, by = "SEQN")

Data_df<-FullData_df|> 
  select("SEQN", "RIAGENDR", "RIDAGEYR", "PHQ020", "PHACOFHR", "PHQ030", "PHAALCHR", "PHAFSTHR", "LBXTC", "LBXIN", "DIQ010", "DIQ050", "DIQ160")|>
  rename("Sequence" = SEQN,
         "Sex" = RIAGENDR,
         "Age" = RIDAGEYR,
        "Coffee_or_Tea_Factor" = PHQ020, "Hrs_CoffeeTea" = PHACOFHR, 
        "Alcohol_Factor" = PHQ030, "Hrs_Alcohol" = PHAALCHR,
        "Hrs_Food" = PHAFSTHR, 
        "Cholesterol" = LBXTC,
        "Insulin" = LBXIN,
        "Diabetes" = DIQ010, "Taking_Insulin" = DIQ050, "Prediabetes" = DIQ160)|>
  mutate(Sex = case_when(Sex == 1 ~"male", 
                         Sex == 2 ~ "female"),
         Coffee_or_Tea_Factor = case_when(Coffee_or_Tea_Factor == 1 ~ "yes",
                                          Coffee_or_Tea_Factor == 2 ~"no",
                                          .default = NA),
         Alcohol_Factor = case_when(Alcohol_Factor == 1 ~ "yes",
                                 Alcohol_Factor == 2 ~ "no", 
                                 .default = NA),
         Diabetes = ifelse(Diabetes == 1, "yes", "other"),
         Prediabetes = ifelse(Prediabetes == 1, "yes", "other"),
         Taking_Insulin = ifelse(Taking_Insulin == 1, "yes", "other"))

```

Cholesterol = mg/dL
Insulin = uU/mL

Coffee_or_Tea_Factor = Whether or not an individual fasted from coffee/tea
Same as alcohol 


### Single Variable Visualizations

#### Sex 

```{r}
Data_df|>group_by(Sex)|>
  summarise(n = n())

ggplot(data = Data_df, aes(x = Sex))+
  geom_bar()+
  theme_minimal()
```

Here we can see that we have similar amounts of males and females in our dataset, but there about 800 more females than males. 

#### Age

```{r}
Data_df|>summarise(mean = mean(Age),
                   sd = sd(Age))

ggplot(data = Data_df, aes(x = Age))+
  geom_histogram()+
  theme_minimal()
```

From our exploration we can see that the distribution of sex in our dataset is a little bimodal, with more individuals between 0-20 and 60-80. In our numerical summary we can see that the mean is 38.3 years old. 

#### Coffee Fast & How Long

```{r}
Data_df|>group_by(Coffee_or_Tea_Factor)|>
  filter(Coffee_or_Tea_Factor == "no"|
           Coffee_or_Tea_Factor == "yes")|>
  summarise(n = n())

coffee_fast<-Data_df|> filter(Coffee_or_Tea_Factor == "yes")

ggplot(data = coffee_fast, aes(y = Hrs_CoffeeTea))+
  geom_boxplot()+
  theme_minimal()

coffee_fast|> summarise(mean = mean(Hrs_CoffeeTea),
                        sd = sd(Hrs_CoffeeTea))
```

Here we can see that only 29 people fasted from coffee/tea. Those that did fast are displayed in the above boxplot, which shows us that the majority of fasting time lies between ~4-11 hours. From a specific numerical summary we can see that the mean fasting time from coffee and tea was 7.55, and there was some spread with the standard deviation falling at 5.88.


#### Length of Food Fast 

```{r}
Data_df|> summarise(mean = mean(Hrs_Food, na.rm = TRUE),
                    median = median(Hrs_Food, na.rm = TRUE),
                    sd= sd(Hrs_Food, na.rm = TRUE))

ggplot(data = Data_df, aes(x = Hrs_Food))+
  geom_histogram()+
  theme_minimal()
```

In our exploration of food fast we can see that the average fast last 8.59 hours and that the standard deviation is 5.64. In our visual, we can see that the distribution of food fast is bi-modal, with popular fast lengths ~4 and ~15 hours. After the second peak, the distribution falls drastically with much smaller numvers of individuals fasting for over 20 hours. 

#### Diabetes & Insulin Usage 

```{r}
Data_df|>group_by(Diabetes)|>
  summarise(n = n())

ggplot(data = Data_df, aes(x = Diabetes))+
  geom_bar()+
  theme_minimal() 

Data_df|>filter(Diabetes == "yes")|>
  group_by(Taking_Insulin)|>
  summarise(n = n())

Diabetes_only<-Data_df|>filter(Diabetes == "yes")

ggplot(data = Diabetes_only, aes(x = Taking_Insulin))+
  geom_bar()+
  theme_minimal()

```

Looking at our data we can see that although a majority do not have diabetes, we do have a subgroup of 1081 individuals who answered "yes" in the survey asking if they have ever been diagnosed with diabetes. We also want to show that out of those 1081 individuals 344 are actively taking insulin. This will be something to be aware of as we continue to analyze the data, and we may want to exclude these individuals. 

#### Cholesterol 

```{r}
Data_df|> summarise( mean = mean(Cholesterol, na.rm = TRUE),
                     sd = sd(Cholesterol, na.rm = TRUE))

ggplot(data = Data_df, aes(x = Cholesterol))+
  geom_histogram()+
  theme_minimal()
```


We can see that cholesterol presents as a unimodal distribution, with a mean around 182mg/dL and sd of 42.3mg/dL. From our histogram, we can see the peak seems to be localized between the 150mg/dL and 250mg/dL range. 

#### Insulin 

```{r}
Data_df|> summarise( mean = mean(Insulin, na.rm = TRUE),
                     sd = sd(Insulin, na.rm = TRUE))

ggplot(data = Data_df, aes(x = Insulin))+
  geom_boxplot()+
  theme_minimal()

Data_InsulinLT200<-Data_df|> filter(Insulin < 100)

Data_InsulinLT200|> summarise( mean = mean(Insulin, na.rm = TRUE),
                     sd = sd(Insulin, na.rm = TRUE))

ggplot(data = Data_InsulinLT200, aes(x = Insulin))+
  geom_boxplot()+
  theme_minimal()

ggplot(data = Data_InsulinLT200, aes(x = Insulin))+
  geom_histogram()+
  theme_minimal()

```

Finally, looking at our last outcome variable insulin, we can see in our visualizations that there are some pretty extreme outliers. Overall, we obtain a mean insulin level of 14.7uU/mL and a standard deviation of 26.1uU/mL. If we are to restrict our range of insulin to <100uU/mL, we can a better understanding of the pattern for the majority of subjects. When we do so we can see that our mean decreases to 13uU/mL and standard deviation of 11.5uU/mL, showing that the outliers are skewing the summary statistics. We can also see in our new graphs that the majority fall around that single peak near 12.5, and then tapers off by 25uU/mL.


### Bivariate Visualization 

```{r}
cor(Data_df$Hrs_Food, Data_df$Cholesterol, use = "pairwise.complete.obs")


ggplot(data = Data_df, aes(x = Hrs_Food, y = Cholesterol, color = factor(Diabetes)))+
  geom_point(na.rm = TRUE)+
  geom_smooth(method = 'lm', se = FALSE, 
              aes(color = factor (Diabetes), group = factor(Diabetes)))+
  labs(color = "Diabetes Status")
  

#ggplot(data = Data_df, aes(x = Hrs_Alcohol, y = Cholesterol, color = factor(Diabetes)))+
 # geom_point(na.rm = TRUE)

#ggplot(data = Data_df, aes(x = Hrs_CoffeeTea, y = Cholesterol, color = factor(Diabetes)))+
 # geom_point(na.rm = TRUE)
```
This plot shows the hours fasted and its impact on cholesterol for the whole population. The correlation is .03205494. The scatter plot hows that those with diabetes are less impacted than those without by hours fasted. We can see that there are less values between 20 and 30 hours fasted from food. 

```{r}
cor(Data_df$Hrs_Food, Data_df$Insulin, use = "pairwise.complete.obs")

ggplot(data = Data_df, aes(x = Hrs_Food, y = Insulin, color = factor(Diabetes)))+
  geom_point(na.rm = TRUE)+
  geom_smooth(method = 'lm', se = FALSE, 
              aes(color = factor (Diabetes), group = factor(Diabetes)))+
  labs(color = "Diabetes Status")

#ggplot(data = Data_df, aes(x = Hrs_Alcohol, y = Insulin, color = factor(Diabetes)))+
#  geom_point(na.rm = TRUE)

#ggplot(data = Data_df, aes(x = Hrs_CoffeeTea, y = Insulin, color = factor(Diabetes)))+
#  geom_point(na.rm = TRUE)
```
The correlation of hours fasted from food and insulin levels is -.1212528. From the scatterplot we can see that with the exception of one person who had an insulin level over 600 uU/ml, all of the data points above 200 uU/ml have diabetes. Additionally, the line of people with diabetes appears to decrease, while line of people who do not appears fairly flat.  

```{r}
Data_df %>%
  drop_na(Sex, Cholesterol) %>%
  group_by(Sex) %>%
  summarise(n = n(),
            mean = mean(Cholesterol),
            median = median(Cholesterol),
            min = min(Cholesterol),
            max = max(Cholesterol),
            q25 = quantile(Cholesterol,.25), # 25th percentile (1st quartile)
            q75 = quantile(Cholesterol,.75), # 75ht percentile (3rd quartile)
            var = var(Cholesterol),
            sd = sd(Cholesterol)) %>%
  mutate(IQR = q75-q25, 
         range = max - min)


ggplot(data = Data_df, aes(x = Sex, y = Cholesterol))+
  geom_boxplot()
#boxplot of cholesterol for each sex 
```

The mean cholesterol level for women (186.1772) was about 10 mg/dL higher than the mean for men (176.1122). 

```{r}
Data_df %>%
  drop_na(Sex, Insulin) %>%
  group_by(Sex) %>%
  summarise(n = n(),
            mean = mean(Insulin),
            median = median(Insulin),
            min = min(Insulin),
            max = max(Insulin),
            q25 = quantile(Insulin,.25), # 25th percentile (1st quartile)
            q75 = quantile(Insulin,.75), # 75ht percentile (3rd quartile)
            var = var(Insulin),
            sd = sd(Insulin)) %>%
  mutate(IQR = q75-q25, 
         range = max - min)

ggplot(data = Data_df, aes(x = Sex, y = Insulin))+
  geom_bar(stat = "summary", fun = "mean")
#average insulin level for each sex
```
```{r}
cor(Data_df$Age, Data_df$Cholesterol, use = "pairwise.complete.obs")

ggplot(data = Data_df, aes(x = Age, y = Cholesterol, color = factor(Diabetes)))+
  geom_point(na.rm = TRUE)+
  geom_smooth(method = 'lm', se = FALSE, 
              aes(color = factor (Diabetes), group = factor(Diabetes)))+
  labs(color = "Diabetes Status")

```

```{r}
cor(Data_df$Age, Data_df$Insulin, use = "pairwise.complete.obs")

ggplot(data = Data_df, aes(x = Age, y = Insulin, color = factor(Diabetes)))+
  geom_point(na.rm = TRUE)+
  geom_smooth(method = 'lm', se = FALSE, 
              aes(color = factor (Diabetes), group = factor(Diabetes)))+
  labs(color = "Diabetes Status")

```


### Summary of Trends Observed so far

trends observed after initial visualization 
